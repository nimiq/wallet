<template>
    <div class="stake-validator-filter">
        <div class="validator-filter-wrapper" v-if="state !== FilterState.SEARCH">
            <button class="validator-switch" :class="{ selected: state === FilterState.TRUST }"
                @click="state = FilterState.TRUST">
                {{ $t('TrustScore') }}
            </button>
            <button class="validator-switch" :class="{ selected: state === FilterState.PAYOUT }"
                @click="state = FilterState.PAYOUT">
                {{ $t('Payout Time') }}
            </button>
            <button class="validator-switch" :class="{ selected: state === FilterState.REWARD }"
                @click="state = FilterState.REWARD">
                {{ $t('Reward') }}
            </button>
            <button class="validator-search-icon" @click="enableSearch">
                <FatSearchIcon />
            </button>
        </div>
        <div class="validator-filter-search-wrapper" v-else>
            <span class="validator-search-icon">
                <FatSearchIcon />
            </span>
            <input type="text" ref="$search" class="validator-search-box"
                :placeholder="$t('Type to search...')" />
            <button class="validator-search-close-icon" @click="state = FilterState.TRUST">
                <XCloseIcon />
            </button>
        </div>
    </div>
</template>

<script lang="ts">
import { defineComponent, watch, ref } from '@vue/composition-api';
import { FilterState } from '../../lib/StakingUtils';
import FatSearchIcon from '../icons/Staking/FatSearchIcon.vue';
import XCloseIcon from '../icons/Staking/XCloseIcon.vue';

export default defineComponent({
    setup(props, context) {
        const state = ref(FilterState.TRUST);
        const $search = ref<HTMLInputElement>();

        watch(state, () => context.emit('changed', state.value));

        function enableSearch() {
            state.value = FilterState.SEARCH;
            context.root.$nextTick(() => $search.value?.focus());
        }

        return {
            state,
            FilterState,
            $search,
            enableSearch,
        };
    },
    components: {
        FatSearchIcon,
        XCloseIcon,
    },
});
</script>

<style lang="scss" scoped>
.stake-validator-filter {
    width: 38rem;
    height: 3.75rem;
    margin: auto;
    margin-bottom: 1.5rem;
    white-space: nowrap;

    .validator-filter-wrapper {
        background-color: var(--text-6);
        height: 3.75rem;
        border-radius: 2rem;
        padding: 0;
        padding-left: .25rem;
        white-space: nowrap;
        overflow: hidden;

        .validator-switch {
            font-family: Muli, Helvetica, serif;
            padding: .75rem 1.25rem;
            height: 3.25rem;

            border: 0;
            background: transparent;
            box-shadow: none;
            border-radius: 2rem;

            font-style: normal;
            font-weight: 700;

            font-size: 1.75rem;
            line-height: 1.75rem;
            text-align: center;

            color: var(--text-50);
            cursor: pointer;

            transition: color 0.3s;

            * {
                select: none;
            }

            &:hover,
            &:focus {
                color: var(--text-80);
            }

            &.selected {
                color: var(--nimiq-blue);
                background: white;
                box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.07),
                            0px 1.875px 3.75px rgba(0, 0, 0, 0.05),
                            0px 0.421263px 2.5px rgba(0, 0, 0, 0.0254662);
                border-radius: 22rem;
            }
        }

        .validator-search-icon {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            margin-left: -.5rem;
            border: 0;
            background: transparent;
            box-shadow: none;
            svg {
                position: relative;
                top: .375rem;
                left: .25rem;
                width: 2.375rem;
                height: 2.375rem;
                opacity: .5;
                line, circle {
                    stroke: rgb(31, 35, 72);
                    stroke-width: 2.0;
                }
            }
        }
    }
    .validator-filter-search-wrapper {
        display: flex;
        width: 22.875rem;
        height: 4rem;
        padding: 0.25rem;
        margin: auto;
        padding-top: 0.125rem;
        flex-direction: row;
        align-items: center;

        text-align: center;
        border: 0.1875rem solid rgba(5, 130, 202, 0.4);
        box-sizing: border-box;
        border-radius: 10.9375rem;

        .validator-search-icon {
            display: flex;
            height: 3.5rem;
            align-items: center;
            margin-left: 1rem;
            margin-right: .25rem;
            svg {
                width: 1.75rem;
                height: 1.75rem;
                opacity:  .7;
                line, circle {
                    stroke: rgb(5, 130, 202);
                }
            }
        }

        .validator-search-box {
            width: 15.125rem;
            font-size: 2rem;
            line-height: 1.75rem;
            color: #0582CA;
            opacity: 0.4;
            border: 0;
            &::placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
                color: #0582CA;
            }
            &:-ms-input-placeholder { /* Internet Explorer 10-11 */
                color: #0582CA;
            }
        }

        .validator-search-close-icon {
            display: flex;
            height: 3.5rem;
            align-items: center;
            cursor: pointer;
            border: 0;
            background: transparent;
            color: #0582CA;
        }
    }
}
</style>
